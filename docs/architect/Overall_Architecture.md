# App-Maker 整体架构设计

## 1. 系统架构概述

### 1.1 架构理念
- **微服务架构**：支持不同Agent功能的独立部署和扩展
- **事件驱动**：基于消息队列的异步处理机制
- **容器化部署**：Docker + Traefik 的轻量级部署方案
- **AI优先**：以BMad-Method为核心的智能开发平台

### 1.2 系统边界
- **前端应用**：Vue.js + Naive UI 的用户界面
- **后端服务**：Go + Gin 的API服务集群
- **AI引擎**：BMad-Method Agent协作框架
- **数据层**：PostgreSQL + Redis 的存储系统
- **部署层**：Docker + Traefik 的容器化部署

## 2. 技术栈选型

### 2.1 前端技术栈
- **框架**：Vue.js 3 + Composition API
- **构建工具**：Vite
- **UI组件库**：Naive UI
- **状态管理**：Pinia
- **路由**：Vue Router 4
- **HTTP客户端**：Axios
- **TypeScript**：完全支持

### 2.2 后端技术栈
- **语言**：Go 1.21+
- **Web框架**：Gin
- **ORM**：GORM
- **验证**：validator
- **配置管理**：Viper
- **日志**：Zap
- **中间件**：CORS, JWT, Rate Limiting

### 2.3 数据存储
- **主数据库**：PostgreSQL 15+
- **缓存数据库**：Redis 7+
- **连接池**：pgxpool
- **Redis客户端**：go-redis

### 2.4 部署和运维
- **容器化**：Docker + Docker Compose
- **反向代理**：Nginx
- **进程管理**：Supervisor
- **监控**：Prometheus + Grafana
- **日志收集**：ELK Stack

## 3. 系统架构图

### 3.1 高层架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用      │    │   后端服务      │    │   数据存储      │
│  (Vue.js)      │◄──►│   (Go + Gin)    │◄──►│  PostgreSQL    │
│                │    │                │    │     Redis      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Nginx        │    │  BMad-Method    │    │   监控系统      │
│   反向代理      │    │   Agent引擎     │    │   Prometheus    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 3.2 微服务架构
```
┌─────────────────────────────────────────────────────────────┐
│                        前端应用层                            │
│                    (Vue.js + Naive UI)                     │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                        API网关层                            │
│                         (Nginx)                            │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                        后端服务层                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │  用户服务   │ │  项目服务   │ │  Agent服务  │          │
│  │  (User)    │ │ (Project)   │ │ (BMad)     │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │  文档服务   │ │  任务服务   │ │  部署服务   │          │
│  │ (Document) │ │  (Task)     │ │ (Deploy)   │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                        数据存储层                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │ PostgreSQL │ │   Redis     │ │  文件存储   │          │
│  │  主数据库   │ │   缓存      │ │  (MinIO)   │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

## 4. 部署架构

### 4.1 容器化部署
```yaml
# docker-compose.yml 结构
services:
  frontend:
    build: ./frontend
    ports: ["80:80"]
    depends_on: [backend]
    
  backend:
    build: ./backend
    ports: ["8080:8080"]
    depends_on: [postgres, redis]
    
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: autocodeweb
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: password
    volumes: ["./data/postgres:/var/lib/postgresql/data"]
    
  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]
    volumes: ["./data/redis:/data"]
```

### 4.2 Nginx配置策略
```nginx
# 前端静态文件服务
location / {
    root /usr/share/nginx/html;
    try_files $uri $uri/ /index.html;
}

# API反向代理
location /api/ {
    proxy_pass http://backend:8080/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
```

## 5. 安全架构

### 5.1 认证授权
- **JWT Token**：无状态认证
- **RBAC权限模型**：基于角色的访问控制
- **API限流**：防止恶意请求
- **HTTPS加密**：传输层安全

### 5.2 数据安全
- **数据库加密**：敏感数据加密存储
- **Redis安全**：网络隔离和密码保护
- **文件上传验证**：类型和大小限制
- **SQL注入防护**：参数化查询

## 6. 性能架构

### 6.1 缓存策略
- **Redis缓存**：热点数据缓存
- **CDN加速**：静态资源分发
- **数据库连接池**：连接复用
- **API响应缓存**：减少重复计算

### 6.2 扩展性设计
- **水平扩展**：无状态服务设计
- **负载均衡**：Nginx负载分发
- **数据库读写分离**：主从架构
- **微服务拆分**：按业务域划分

## 7. 监控和运维

### 7.1 监控指标
- **系统指标**：CPU、内存、磁盘、网络
- **应用指标**：响应时间、吞吐量、错误率
- **业务指标**：用户活跃度、项目成功率
- **Agent指标**：协作效率、任务完成率

### 7.2 日志管理
- **结构化日志**：JSON格式日志
- **日志聚合**：ELK Stack收集分析
- **日志轮转**：自动清理过期日志
- **错误追踪**：异常堆栈信息

## 8. 灾难恢复

### 8.1 备份策略
- **数据库备份**：每日全量 + 实时增量
- **文件备份**：重要文件定期备份
- **配置备份**：系统配置版本管理
- **代码备份**：Git版本控制

### 8.2 恢复计划
- **RTO目标**：4小时内恢复服务
- **RPO目标**：1小时内数据丢失
- **故障转移**：多机房部署
- **数据一致性**：事务完整性保证

---

*本文档为 AutoCodeWeb 项目的整体架构设计，由架构师 Winston 创建*
