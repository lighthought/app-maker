.PHONY: help build build-dev build-prod run-dev run-prod test clean validate-config

# é»˜è®¤ç›®æ ‡
help:
	@echo "AutoCodeWeb Backend æ„å»ºå·¥å…·"
	@echo "=========================="
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  build-dev     - æ„å»ºå¼€å‘ç¯å¢ƒé•œåƒ"
	@echo "  build-prod    - æ„å»ºç”Ÿäº§ç¯å¢ƒé•œåƒ"
	@echo "  run-dev       - å¯åŠ¨å¼€å‘ç¯å¢ƒ"
	@echo "  run-prod      - å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ"
	@echo "  test          - è¿è¡Œæµ‹è¯•"
	@echo "  clean         - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  validate-config - éªŒè¯é…ç½®æ–‡ä»¶"

# æ„å»ºå¼€å‘ç¯å¢ƒé•œåƒ
build-dev:
	@echo "ğŸ”¨ æ„å»ºå¼€å‘ç¯å¢ƒé•œåƒ..."
	docker-compose build backend

# æ„å»ºç”Ÿäº§ç¯å¢ƒé•œåƒ
build-prod:
	@echo "ğŸ”¨ æ„å»ºç”Ÿäº§ç¯å¢ƒé•œåƒ..."
	docker build -f Dockerfile.prod -t autocodeweb-backend:prod .

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
run-dev:
	@echo "ğŸš€ å¯åŠ¨å¼€å‘ç¯å¢ƒ..."
	docker-compose up -d

# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
run-prod:
	@echo "ğŸš€ å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ..."
	docker-compose -f docker-compose.prod.yml up -d

# åœæ­¢å¼€å‘ç¯å¢ƒ
stop-dev:
	@echo "ğŸ›‘ åœæ­¢å¼€å‘ç¯å¢ƒ..."
	docker-compose down

# åœæ­¢ç”Ÿäº§ç¯å¢ƒ
stop-prod:
	@echo "ğŸ›‘ åœæ­¢ç”Ÿäº§ç¯å¢ƒ..."
	docker-compose -f docker-compose.prod.yml down

# æŸ¥çœ‹æ—¥å¿—
logs-dev:
	docker-compose logs -f backend

logs-prod:
	docker-compose -f docker-compose.prod.yml logs -f backend

# éªŒè¯é…ç½®
validate-config:
	@echo "ğŸ” éªŒè¯å¼€å‘ç¯å¢ƒé…ç½®..."
	APP_ENVIRONMENT=development go run cmd/server/main.go --validate-only
	@echo "ğŸ” éªŒè¯ç”Ÿäº§ç¯å¢ƒé…ç½®..."
	APP_ENVIRONMENT=production go run cmd/server/main.go --validate-only

# æ¸…ç†
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	docker-compose down -v
	docker system prune -f
	docker image prune -f

# æµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	go test ./...

# æ ¼å¼åŒ–ä»£ç 
fmt:
	@echo "âœ¨ æ ¼å¼åŒ–ä»£ç ..."
	go fmt ./...

# ä»£ç æ£€æŸ¥
lint:
	@echo "ğŸ” ä»£ç æ£€æŸ¥..."
	golangci-lint run

# æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶
build-bin:
	@echo "ğŸ”¨ æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶..."
	go build -o bin/server ./cmd/server

# è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶
run-bin:
	@echo "ğŸš€ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶..."
	./bin/server
