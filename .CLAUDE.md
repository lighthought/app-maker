# App Maker é¡¹ç›®æ¶æ„ä¸è®¾è®¡æ–‡æ¡£

> æœ¬æ–‡æ¡£ä¸º Claude AI åŠ©æ‰‹å‡†å¤‡ï¼Œç”¨äºå¿«é€Ÿç†è§£é¡¹ç›®æ¶æ„ã€è®¾è®¡æ€è·¯å’Œå¼€å‘è§„èŒƒï¼Œç¡®ä¿åœ¨æ–°ä¼šè¯ä¸­ä¿æŒä¸€è‡´çš„æ¶æ„å’Œæ–¹æ¡ˆã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**App Maker** æ˜¯ä¸€ä¸ªåŸºäºå¤š Agent åä½œçš„è‡ªåŠ¨åŒ–è½¯ä»¶å¼€å‘å¹³å°ï¼Œé€šè¿‡ AI Agent çš„ååŒå·¥ä½œï¼Œæ ¹æ®ç”¨æˆ·éœ€æ±‚è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„å‰åç«¯é¡¹ç›®ã€‚

### æ ¸å¿ƒç†å¿µ
- **æƒ³æ³•å³åº”ç”¨**: ç”¨æˆ·åªéœ€æè¿°éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå®Œæ•´é¡¹ç›®
- **å¤š Agent åä½œ**: PMã€UXã€Architectã€POã€Dev ç­‰ä¸“ä¸šè§’è‰²ååŒå·¥ä½œ
- **æ ‡å‡†åŒ–æµç¨‹**: é¢„å®šä¹‰çš„å¼€å‘é˜¶æ®µæµç¨‹ï¼Œç¡®ä¿é¡¹ç›®è´¨é‡
- **å®¹å™¨åŒ–éƒ¨ç½²**: ç”Ÿæˆçš„é¡¹ç›®å¯ç›´æ¥å®¹å™¨åŒ–éƒ¨ç½²

### æŠ€æœ¯æ ˆæ€»è§ˆ
- **Frontend**: Vue 3 + TypeScript + Naive UI + Pinia
- **Backend**: Go + Gin + GORM + PostgreSQL + Asynq + Redis
- **Agents**: Go + Gin + Asynq + Redis
- **Shared-models**: Go æ¨¡å—ï¼Œæä¾›å…±äº«æ•°æ®æ¨¡å‹å’Œå®¢æˆ·ç«¯
- **éƒ¨ç½²**: Docker + GitLab CI/CD + Traefik

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚   Backend       â”‚    â”‚   Agents        â”‚
â”‚  (Vue.js 3)     â”‚â—„â”€â”€â–ºâ”‚   (Go + Gin)    â”‚â—„â”€â”€â–ºâ”‚  (Go + Gin)     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx         â”‚    â”‚  PostgreSQL     â”‚    â”‚   BMad CLI      â”‚
â”‚   (åå‘ä»£ç†)     â”‚    â”‚  Redis          â”‚    â”‚   Claude Code   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶å…³ç³»

1. **Frontend â†’ Backend**
   - HTTP REST API è°ƒç”¨
   - WebSocket å®æ—¶é€šä¿¡
   - JWT Token è®¤è¯

2. **Backend â†’ Agents**
   - é€šè¿‡ `shared-models/client.AgentClient` è°ƒç”¨
   - å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— (Asynq)
   - ä»»åŠ¡çŠ¶æ€è½®è¯¢

3. **Agents â†’ External Tools**
   - BMad CLI (æ”¯æŒ Claude Code, Qwen Code, Gemini ä¸‰ç§ CLI)
   - Git ç‰ˆæœ¬æ§åˆ¶
   - NPM/Node.js ç¯å¢ƒ

---

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
app-maker/
â”œâ”€â”€ frontend/                 # Vue.js å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # ç»„ä»¶ (layout, common, business)
â”‚   â”‚   â”œâ”€â”€ pages/          # é¡µé¢ (Home, Auth, Dashboard, ProjectEdit)
â”‚   â”‚   â”œâ”€â”€ stores/         # Pinia çŠ¶æ€ç®¡ç† (user, project, file)
â”‚   â”‚   â”œâ”€â”€ router/         # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•° (http, config, log, time)
â”‚   â”‚   â””â”€â”€ types/          # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ architect/          # å‰ç«¯æ¶æ„æ–‡æ¡£
â”‚
â”œâ”€â”€ backend/                 # Go åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ cmd/server/         # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ api/            # API å¤„ç†å™¨ (handlers, middleware, routes)
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘ (project, user, websocket, file)
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹ (user, project, conversation, stage)
â”‚   â”‚   â”œâ”€â”€ repositories/   # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ config/         # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ container/      # ä¾èµ–æ³¨å…¥å®¹å™¨
â”‚   â”‚   â””â”€â”€ worker/         # Asynq å¼‚æ­¥ä»»åŠ¡å¤„ç†
â”‚   â”œâ”€â”€ pkg/cache/          # Redis ç¼“å­˜ç®¡ç†
â”‚   â””â”€â”€ architect/          # åç«¯æ¶æ„æ–‡æ¡£
â”‚
â”œâ”€â”€ agents/                  # Agents æœåŠ¡
â”‚   â”œâ”€â”€ cmd/server/         # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ api/            # API å¤„ç†å™¨ (pm, ux, architect, po, dev)
â”‚   â”‚   â”œâ”€â”€ services/       # Agent æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ agent_task_service.go  # ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ command_service.go     # å‘½ä»¤æ‰§è¡Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ git_service.go         # Git æ“ä½œ
â”‚   â”‚   â”‚   â””â”€â”€ project_service.go     # é¡¹ç›®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config/         # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ container/      # ä¾èµ–æ³¨å…¥å®¹å™¨
â”‚   â””â”€â”€ design/             # Agents æ¶æ„æ–‡æ¡£
â”‚
â”œâ”€â”€ shared-models/          # å…±äº«æ¨¡å— (Go)
â”‚   â”œâ”€â”€ agent/              # Agent è¯·æ±‚å“åº”æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ requests.go     # è¯·æ±‚ç»“æ„ä½“ (SetupProjEnvReq, GetPRDReq ç­‰)
â”‚   â”‚   â”œâ”€â”€ response.go     # å“åº”ç»“æ„ä½“
â”‚   â”‚   â””â”€â”€ roles.go        # Agent è§’è‰²å®šä¹‰
â”‚   â”œâ”€â”€ client/             # HTTP å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ agent_client.go # Agent æœåŠ¡å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ http_client.go  # HTTP å®¢æˆ·ç«¯å°è£…
â”‚   â”œâ”€â”€ common/             # é€šç”¨å¸¸é‡å’Œå“åº”
â”‚   â”‚   â”œâ”€â”€ constants.go    # å¼€å‘é˜¶æ®µã€Agent ç±»å‹ç­‰å¸¸é‡
â”‚   â”‚   â””â”€â”€ response.go     # ç»Ÿä¸€å“åº”ç»“æ„
â”‚   â”œâ”€â”€ tasks/              # å¼‚æ­¥ä»»åŠ¡æ¨¡å‹
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•° (file, password, time, uuid, zip)
â”‚   â””â”€â”€ logger/             # æ—¥å¿—ç®¡ç†
â”‚
â””â”€â”€ docs/                   # é¡¹ç›®æ–‡æ¡£
    â”œâ”€â”€ architect/          # æ¶æ„è®¾è®¡æ–‡æ¡£
    â”œâ”€â”€ design/             # è®¾è®¡è§„èŒƒ
    â”œâ”€â”€ PRD/                # äº§å“éœ€æ±‚æ–‡æ¡£
    â””â”€â”€ stories/            # Epic å’Œ Story æ–‡æ¡£
```

---

## ğŸ‘¥ Agent è§’è‰²ä¸åä½œæµç¨‹

### Agent è§’è‰²å®šä¹‰

| Agent | ä¸­æ–‡å | è‹±æ–‡å | èŒè´£ |
|-------|--------|--------|------|
| Analyst | éœ€æ±‚åˆ†æå¸ˆ | Mary | åˆ†æé¡¹ç›®éœ€æ±‚ï¼Œç”Ÿæˆé¡¹ç›®ç®€ä»‹å’Œå¸‚åœºç ”ç©¶ |
| PM | äº§å“ç»ç† | John | ç¼–å†™äº§å“éœ€æ±‚æ–‡æ¡£(PRD) |
| UX Expert | UXä¸“å®¶ | Sally | è®¾è®¡ç”¨æˆ·ä½“éªŒæ ‡å‡†å’Œç•Œé¢è§„èŒƒ |
| Architect | æ¶æ„å¸ˆ | Winston | è®¾è®¡ç³»ç»Ÿã€å‰ç«¯ã€åç«¯æŠ€æœ¯æ¶æ„ï¼Œè¾“å‡ºAPIã€æ•°æ®åº“è®¾è®¡æ–‡æ¡£ |
| PO | äº§å“è´Ÿè´£äºº | Sarah | åˆ’åˆ†Epicå’Œç”¨æˆ·æ•…äº‹ï¼Œä»»åŠ¡åˆ†è§£å’Œä¼˜å…ˆçº§ç®¡ç† |
| Dev | å¼€å‘å·¥ç¨‹å¸ˆ | James | å®ç°ç”¨æˆ·æ•…äº‹ã€ä¿®å¤Bugã€æµ‹è¯•ã€éƒ¨ç½² |

### å¼€å‘é˜¶æ®µæµç¨‹

```
ç”¨æˆ·éœ€æ±‚è¾“å…¥ 
  â†“
åˆå§‹åŒ– (initializing)
  â†“
ç¯å¢ƒå‡†å¤‡ (setup_environment) â†’ é¡¹ç›® Cloneã€ä¾èµ–å®‰è£…
  â†“
ç­‰å¾…Agents (pending_agents)
  â†“
éœ€æ±‚æ£€æŸ¥ (check_requirement) â†’ Analyst Agent
  â†“
ç”ŸæˆPRD (generate_prd) â†’ PM Agent
  â†“
å®šä¹‰UXæ ‡å‡† (define_ux_standard) â†’ UX Expert Agent
  â†“
è®¾è®¡æ¶æ„ (design_architecture) â†’ Architect Agent
  â†“
åˆ’åˆ†Epic/Story (plan_epic_and_story) â†’ PO Agent
  â†“
å®šä¹‰æ•°æ®æ¨¡å‹ (define_data_model) â†’ Architect Agent
  â†“
å®šä¹‰APIæ¥å£ (define_api) â†’ Architect Agent
  â†“
å¼€å‘Story (develop_story) â†’ Dev Agent
  â†“
ä¿®å¤Bug (fix_bug) â†’ Dev Agent (å¯é€‰)
  â†“
è¿è¡Œæµ‹è¯• (run_test) â†’ Dev Agent
  â†“
éƒ¨ç½² (deploy) â†’ Dev Agent
  â†“
å®Œæˆ (done)
```

### é˜¶æ®µå¸¸é‡å®šä¹‰

**ä½ç½®**: `shared-models/common/constants.go`

```go
const (
    DevStatusInitializing       = "initializing"        // ç­‰å¾…å¼€å§‹
    DevStatusSetupEnvironment   = "setup_environment"   // ç¯å¢ƒå¤„ç†
    DevStatusPendingAgents      = "pending_agents"      // ç­‰å¾…Agentså¤„ç†
    DevStatusCheckRequirement   = "check_requirement"   // éœ€æ±‚æ£€æŸ¥
    DevStatusGeneratePRD        = "generate_prd"        // ç”ŸæˆPRD
    DevStatusDefineUXStandard   = "define_ux_standard"  // UXæ ‡å‡†å®šä¹‰
    DevStatusDesignArchitecture = "design_architecture" // æ¶æ„è®¾è®¡
    DevStatusPlanEpicAndStory   = "plan_epic_and_story" // Epic/Storyåˆ’åˆ†
    DevStatusDefineDataModel    = "define_data_model"   // æ•°æ®æ¨¡å‹å®šä¹‰
    DevStatusDefineAPI          = "define_api"          // APIæ¥å£å®šä¹‰
    DevStatusDevelopStory       = "develop_story"       // Storyå¼€å‘
    DevStatusFixBug             = "fix_bug"             // Bugä¿®å¤
    DevStatusRunTest            = "run_test"            // è‡ªåŠ¨æµ‹è¯•
    DevStatusDeploy             = "deploy"              // éƒ¨ç½²
    DevStatusDone               = "done"                // å®Œæˆ
    DevStatusFailed             = "failed"              // å¤±è´¥
)
```

---

## ğŸ”„ æ•°æ®æµä¸è°ƒç”¨å…³ç³»

### 1. é¡¹ç›®åˆ›å»ºæµç¨‹

```
Frontend (CreateProject.vue)
  â†“ POST /api/v1/projects
Backend (ProjectHandler.Create)
  â†“ CreateProject()
ProjectService
  â†“ Create in DB
  â†“ Enqueue Task (Asynq)
Worker (project.go)
  â†“ ProcessTask()
ProjectStageService
  â†“ handleProjectDevelopmentTask()
  â†“ AgentClient.SetupProjectEnvironment()
Agents Service (/api/v1/project/setup)
  â†“ Clone Repo, Install Dependencies
  â†“ Git Commit & Push
Backend
  â†“ Update Project Status
  â†“ WebSocket Notify
Frontend
  â†“ Display Progress
```

### 2. Agent ä»»åŠ¡æ‰§è¡Œæµç¨‹

**Backend è°ƒç”¨ Agents**:
```go
// backend/internal/services/project_stage_service.go
agentClient := client.NewAgentClient(s.agentsURL, 10*time.Second)

// è°ƒç”¨ PM Agent ç”Ÿæˆ PRD
result, err := agentClient.GetPRD(ctx, &agent.GetPRDReq{
    ProjectGuid:  project.GUID,
    Requirements: project.Requirements,
})
```

**Agents å¤„ç†ä»»åŠ¡**:
```go
// agents/internal/api/handlers/pm_handler.go
func (h *PmHandler) GetPRD(c *gin.Context) {
    var req agent.GetPRDReq
    c.ShouldBindJSON(&req)
    
    // åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
    taskID := uuid.NewString()
    h.agentTaskService.Enqueue(req.ProjectGuid, "pm", "prd", req.ToBytes())
    
    c.JSON(200, utils.GetSuccessResponse("PRDä»»åŠ¡å·²æäº¤", taskID))
}
```

**Agents Worker æ‰§è¡Œ**:
```go
// agents/internal/services/agent_task_service.go
func (s *agentTaskService) ProcessTask(ctx context.Context, task *asynq.Task) error {
    // æ‰§è¡Œ BMad CLI å‘½ä»¤
    result := s.commandService.SimpleExecute(ctx, workDir, "bmad", "run", "--prompt", promptFile)
    
    // Git æäº¤
    s.gitService.CommitAndPush(ctx, projectGuid, "Generated PRD document")
    
    return nil
}
```

### 3. WebSocket å®æ—¶é€šä¿¡

**Backend æ¨é€æ¶ˆæ¯**:
```go
// backend/internal/services/websocket_service.go
func (s *webSocketService) NotifyProjectStageUpdate(ctx context.Context, projectGuid string, stage *models.DevStage) {
    message := models.WebSocketMessage{
        Type: common.WebSocketMessageTypeProjectStageUpdate,
        Data: stage,
    }
    s.broadcastToProject(projectGuid, message)
}
```

**Frontend æ¥æ”¶æ¶ˆæ¯**:
```typescript
// frontend/src/utils/websocket.ts
ws.onmessage = (event) => {
  const message = JSON.parse(event.data)
  
  if (message.type === 'project_stage_update') {
    // æ›´æ–°é¡¹ç›®é˜¶æ®µçŠ¶æ€
    projectStore.updateStage(message.data)
  }
}
```

---

## ğŸ“¦ Shared-Models æ ¸å¿ƒåŠŸèƒ½

### 1. Agent è¯·æ±‚æ¨¡å‹

**ä½ç½®**: `shared-models/agent/requests.go`

```go
// é¡¹ç›®ç¯å¢ƒå‡†å¤‡
type SetupProjEnvReq struct {
    ProjectGuid     string `json:"project_guid"`
    GitlabRepoUrl   string `json:"gitlab_repo_url"`
    SetupBmadMethod bool   `json:"setup_bmad_method"`
    BmadCliType     string `json:"bmad_cli_type"`
    AiModel         string `json:"ai_model"`
    ModelProvider   string `json:"model_provider"`
    ApiToken        string `json:"api_token"`
}

// PRD ç”Ÿæˆ
type GetPRDReq struct {
    ProjectGuid  string `json:"project_guid"`
    Requirements string `json:"requirements"`
    CliTool      string `json:"cli_tool"` // æ”¯æŒçš„ CLI ç±»å‹
}

// Epic/Story åˆ’åˆ†
type GetEpicsAndStoriesReq struct {
    ProjectGuid string `json:"project_guid"`
    PrdPath     string `json:"prd_path"`
    ArchFolder  string `json:"arch_folder"`
    CliTool     string `json:"cli_tool"` // æ”¯æŒçš„ CLI ç±»å‹
}

// Story å®ç°
type ImplementStoryReq struct {
    ProjectGuid string `json:"project_guid"`
    PrdPath     string `json:"prd_path"`
    ArchFolder  string `json:"arch_folder"`
    DbFolder    string `json:"db_folder"`
    ApiFolder   string `json:"api_folder"`
    UxSpecPath  string `json:"ux_spec_path"`
    EpicFile    string `json:"epic_file"`
    StoryFile   string `json:"story_file"`
    CliTool     string `json:"cli_tool"` // æ”¯æŒçš„ CLI ç±»å‹
}
```

### 2. Agent å®¢æˆ·ç«¯

**ä½ç½®**: `shared-models/client/agent_client.go`

```go
type AgentClient struct {
    httpClient *HTTPClient
}

// æ ¸å¿ƒæ–¹æ³•
func (c *AgentClient) SetupProjectEnvironment(ctx context.Context, req *agent.SetupProjEnvReq) (*tasks.TaskResult, error)
func (c *AgentClient) AnalyseProjectBrief(ctx context.Context, req *agent.GetProjBriefReq) (*tasks.TaskResult, error)
func (c *AgentClient) GetPRD(ctx context.Context, req *agent.GetPRDReq) (*tasks.TaskResult, error)
func (c *AgentClient) GetUXStandard(ctx context.Context, req *agent.GetUXStandardReq) (*tasks.TaskResult, error)
func (c *AgentClient) GetArchitecture(ctx context.Context, req *agent.GetArchitectureReq) (*tasks.TaskResult, error)
func (c *AgentClient) GetEpicsAndStories(ctx context.Context, req *agent.GetEpicsAndStoriesReq) (*tasks.TaskResult, error)
func (c *AgentClient) ImplementStory(ctx context.Context, req *agent.ImplementStoryReq) (*tasks.TaskResult, error)
func (c *AgentClient) FixBug(ctx context.Context, req *agent.FixBugReq) (*tasks.TaskResult, error)
```

### 3. é€šç”¨å¸¸é‡

**ä½ç½®**: `shared-models/common/constants.go`

```go
// Agent ç±»å‹å¸¸é‡
const (
    AgentTypeAnalyse    = "analyst"
    AgentTypePM         = "pm"
    AgentTypeUX         = "ux-expert"
    AgentTypeArchitect  = "architect"
    AgentTypePO         = "po"
    AgentTypeDev        = "dev"
)

// CLI å·¥å…·ç±»å‹å¸¸é‡
const (
    CliToolClaudeCode = "claude-code"
    CliToolQwenCode   = "qwen-code"
    CliToolGemini     = "gemini"
)

// ä»»åŠ¡ç±»å‹å¸¸é‡
const (
    TaskTypeProjectDevelopment = "project:development"
    TaskTypeProjectDeploy      = "project:deploy"
    TaskTypeAgentExecute       = "agent:execute"
)

// WebSocket æ¶ˆæ¯ç±»å‹
const (
    WebSocketMessageTypeProjectStageUpdate = "project_stage_update"
    WebSocketMessageTypeProjectMessage     = "project_message"
    WebSocketMessageTypeProjectInfoUpdate  = "project_info_update"
)
```

---

## ğŸ’¾ æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

**1. Users (ç”¨æˆ·è¡¨)**
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(100),
    avatar_url VARCHAR(500),
    role VARCHAR(50) DEFAULT 'user',
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**2. Projects (é¡¹ç›®è¡¨)**
```sql
CREATE TABLE projects (
    id UUID PRIMARY KEY,
    guid VARCHAR(100) UNIQUE NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    requirements TEXT,
    user_id UUID REFERENCES users(id),
    status VARCHAR(50) DEFAULT 'draft',
    dev_status VARCHAR(50) DEFAULT 'initializing',
    dev_progress INTEGER DEFAULT 0,
    project_path VARCHAR(500),
    gitlab_repo_url VARCHAR(500),
    backend_port INTEGER,
    frontend_port INTEGER,
    current_task_id VARCHAR(100),
    bmad_cli_type VARCHAR(50),
    ai_model VARCHAR(100),
    model_provider VARCHAR(50),
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**3. Dev_Stages (å¼€å‘é˜¶æ®µè¡¨)**
```sql
CREATE TABLE dev_stages (
    id UUID PRIMARY KEY,
    project_id UUID REFERENCES projects(id),
    project_guid VARCHAR(100),
    name VARCHAR(100) NOT NULL,
    status VARCHAR(50) DEFAULT 'pending',
    progress INTEGER DEFAULT 0,
    log_data TEXT,
    task_id VARCHAR(100),
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**4. Conversation_Messages (å¯¹è¯æ¶ˆæ¯è¡¨)**
```sql
CREATE TABLE conversation_messages (
    id UUID PRIMARY KEY,
    project_guid VARCHAR(100),
    type VARCHAR(20) NOT NULL,
    agent_role VARCHAR(50),
    agent_name VARCHAR(100),
    content TEXT NOT NULL,
    markdown_content TEXT,
    is_markdown BOOLEAN DEFAULT FALSE,
    is_expanded BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP
);
```

---

## ğŸ¨ Frontend æ¶æ„è®¾è®¡

### ç»„ä»¶å±‚æ¬¡ç»“æ„

```
App.vue
  â”œâ”€â”€ PageLayout (å¸ƒå±€ç»„ä»¶)
  â”‚   â”œâ”€â”€ Header (é¡¶éƒ¨å¯¼èˆª)
  â”‚   â”œâ”€â”€ Sidebar (ä¾§è¾¹æ )
  â”‚   â””â”€â”€ RouterView (é¡µé¢å†…å®¹)
  â”‚
  â”œâ”€â”€ Home (é¦–é¡µ)
  â”‚   â””â”€â”€ SmartInput (æ™ºèƒ½è¾“å…¥æ¡†)
  â”‚
  â”œâ”€â”€ Auth (è®¤è¯é¡µ)
  â”‚
  â”œâ”€â”€ Dashboard (ä»ªè¡¨æ¿)
  â”‚
  â””â”€â”€ ProjectEdit (é¡¹ç›®ç¼–è¾‘)
      â”œâ”€â”€ ConversationContainer (å¯¹è¯å®¹å™¨)
      â”‚   â”œâ”€â”€ ConversationMessage (å¯¹è¯æ¶ˆæ¯)
      â”‚   â””â”€â”€ DevStages (å¼€å‘é˜¶æ®µ)
      â”‚
      â””â”€â”€ ProjectPanel (é¡¹ç›®é¢æ¿)
          â”œâ”€â”€ FileTreeNode (æ–‡ä»¶æ ‘)
          â””â”€â”€ MonacoEditor (ä»£ç ç¼–è¾‘å™¨)
```

### çŠ¶æ€ç®¡ç† (Pinia Stores)

**1. User Store** (`frontend/src/stores/user.ts`)
```typescript
export const useUserStore = defineStore('user', () => {
  const user = ref<User | null>(null)
  const token = ref<string>('')
  const isAuthenticated = computed(() => !!token.value)
  
  function login(credentials: LoginCredentials) { /* ... */ }
  function logout() { /* ... */ }
  function updateProfile(profile: UserProfile) { /* ... */ }
  
  return { user, token, isAuthenticated, login, logout, updateProfile }
})
```

**2. Project Store** (`frontend/src/stores/project.ts`)
```typescript
export const useProjectStore = defineStore('project', () => {
  const projects = ref<Project[]>([])
  const currentProject = ref<Project | null>(null)
  
  async function fetchProjects(params?: ProjectListRequest) { /* ... */ }
  async function createProject(data: CreateProjectData) { /* ... */ }
  async function getProject(id: string) { /* ... */ }
  async function deleteProject(id: string) { /* ... */ }
  async function getProjectMessages(projectGuid: string) { /* ... */ }
  async function getProjectStages(projectGuid: string) { /* ... */ }
  
  return { 
    projects, currentProject, 
    fetchProjects, createProject, getProject, deleteProject,
    getProjectMessages, getProjectStages
  }
})
```

### HTTP æœåŠ¡å°è£…

**ä½ç½®**: `frontend/src/utils/http.ts`

```typescript
class HttpService {
  private instance: AxiosInstance
  
  constructor() {
    this.instance = axios.create({
      baseURL: import.meta.env.VITE_API_BASE_URL,
      timeout: 10000
    })
    this.setupInterceptors()
  }
  
  private setupInterceptors() {
    // è¯·æ±‚æ‹¦æˆªå™¨ - æ·»åŠ  Token
    this.instance.interceptors.request.use(config => {
      const token = localStorage.getItem('token')
      if (token) {
        config.headers.Authorization = `Bearer ${token}`
      }
      return config
    })
    
    // å“åº”æ‹¦æˆªå™¨ - å¤„ç†é”™è¯¯å’Œ Token åˆ·æ–°
    this.instance.interceptors.response.use(
      response => response.data,
      error => {
        if (error.response?.status === 401) {
          // è‡ªåŠ¨åˆ·æ–° Token æˆ–è·³è½¬ç™»å½•
          this.handleUnauthorized()
        }
        return Promise.reject(error)
      }
    )
  }
}
```

---

## ğŸ”§ Backend æ ¸å¿ƒæœåŠ¡

### æœåŠ¡å±‚æ¶æ„

**1. Project Service** (`backend/internal/services/project_service.go`)
```go
type ProjectService interface {
    Create(ctx context.Context, req *models.CreateProjectRequest, userID string) (*models.Project, error)
    GetByID(ctx context.Context, id string, userID string) (*models.Project, error)
    List(ctx context.Context, req *models.ProjectListRequest, userID string) ([]*models.Project, int64, error)
    Delete(ctx context.Context, id string, userID string) error
    Update(ctx context.Context, id string, req *models.UpdateProjectRequest, userID string) (*models.Project, error)
}
```

**2. Project Stage Service** (`backend/internal/services/project_stage_service.go`)
```go
type ProjectStageService interface {
    GetProjectStages(ctx context.Context, projectGuid string) ([]*models.DevStage, error)
    ProcessTask(ctx context.Context, task *asynq.Task) error
}

// æ ¸å¿ƒæ‰§è¡Œé€»è¾‘
func (s *projectStageService) handleProjectDevelopmentTask(ctx context.Context, task *asynq.Task) error {
    // è§£æä»»åŠ¡
    var payload tasks.ProjectTaskPayload
    json.Unmarshal(task.Payload(), &payload)
    
    // è·å–é¡¹ç›®
    project := s.projectRepo.GetByGUID(ctx, payload.ProjectGuid)
    
    // åˆ›å»º Agent å®¢æˆ·ç«¯
    agentClient := client.NewAgentClient(s.agentsURL, 10*time.Second)
    
    // æŒ‰é¡ºåºæ‰§è¡Œå¼€å‘é˜¶æ®µ
    stages := []struct{
        status      common.DevStatus
        executor    func(...) error
    }{
        {DevStatusPendingAgents, s.pendingAgents},
        {DevStatusCheckRequirement, s.checkRequirement},
        {DevStatusGeneratePRD, s.generatePRD},
        {DevStatusDefineUXStandard, s.defineUXStandards},
        {DevStatusDesignArchitecture, s.designArchitecture},
        {DevStatusPlanEpicAndStory, s.planEpicsAndStories},
        {DevStatusDefineDataModel, s.defineDataModel},
        {DevStatusDefineAPI, s.defineAPIs},
        {DevStatusRunTest, s.runTests},
        {DevStatusDeploy, s.packageProject},
    }
    
    for _, stage := range stages {
        stage.executor(ctx, project, agentClient, ...)
    }
}
```

**3. WebSocket Service** (`backend/internal/services/websocket_service.go`)
```go
type WebSocketService interface {
    HandleConnection(ctx context.Context, userID string, conn *websocket.Conn)
    NotifyProjectStageUpdate(ctx context.Context, projectGuid string, stage *models.DevStage)
    NotifyProjectMessage(ctx context.Context, projectGuid string, message *models.ConversationMessage)
    NotifyProjectInfoUpdate(ctx context.Context, projectGuid string, project *models.Project)
}
```

### Asynq å¼‚æ­¥ä»»åŠ¡

**ä»»åŠ¡åˆ›å»º** (`backend/internal/worker/project.go`)
```go
func CreateProjectDevelopmentTask(projectGuid string) (*asynq.Task, error) {
    payload := tasks.ProjectTaskPayload{
        ProjectGuid: projectGuid,
    }
    payloadBytes, _ := json.Marshal(payload)
    
    return asynq.NewTask(common.TaskTypeProjectDevelopment, payloadBytes), nil
}
```

**ä»»åŠ¡å¤„ç†** (`backend/internal/worker/project.go`)
```go
func HandleProjectDevelopmentTask(ctx context.Context, task *asynq.Task) error {
    container := GetContainer() // ä¾èµ–æ³¨å…¥å®¹å™¨
    return container.ProjectStageService.ProcessTask(ctx, task)
}
```

---

## ğŸ¤– Agents æœåŠ¡æ¶æ„

### Handlers å±‚

**PM Handler** (`agents/internal/api/handlers/pm_handler.go`)
```go
type PmHandler struct {
    agentTaskService services.AgentTaskService
}

func (h *PmHandler) GetPRD(c *gin.Context) {
    var req agent.GetPRDReq
    c.ShouldBindJSON(&req)
    
    taskID, err := h.agentTaskService.Enqueue(
        req.ProjectGuid,
        common.AgentTypePM,
        "prd",
        req.ToBytes(),
    )
    
    c.JSON(200, utils.GetSuccessResponse("PRDä»»åŠ¡å·²æäº¤", taskID))
}
```

**Architect Handler** (`agents/internal/api/handlers/architect_handler.go`)
```go
type ArchitectHandler struct {
    agentTaskService services.AgentTaskService
}

func (h *ArchitectHandler) GetArchitecture(c *gin.Context) { /* ... */ }
func (h *ArchitectHandler) GetDatabase(c *gin.Context) { /* ... */ }
func (h *ArchitectHandler) GetAPIDefinition(c *gin.Context) { /* ... */ }
```

### Services å±‚

**Agent Task Service** (`agents/internal/services/agent_task_service.go`)
```go
type AgentTaskService interface {
    Enqueue(projectGuid, agentType, taskType string, payload []byte) (string, error)
    ProcessTask(ctx context.Context, task *asynq.Task) error
    GetTaskStatus(ctx context.Context, taskID string) (*tasks.TaskResult, error)
}

// ä»»åŠ¡æ‰§è¡Œ
func (s *agentTaskService) ProcessTask(ctx context.Context, task *asynq.Task) error {
    // 1. è§£æä»»åŠ¡
    var payload AgentTaskPayload
    json.Unmarshal(task.Payload(), &payload)
    
    // 2. æ„å»º Prompt æ–‡ä»¶
    promptPath := s.buildPrompt(payload)
    
    // 3. æ‰§è¡Œ BMad CLI
    result := s.commandService.SimpleExecute(
        ctx, workDir, "bmad", "run", "--prompt", promptPath
    )
    
    // 4. Git æäº¤
    s.gitService.CommitAndPush(ctx, payload.ProjectGuid, commitMessage)
    
    // 5. æ›´æ–°ä»»åŠ¡ç»“æœ
    return nil
}
```

**Command Service** (`agents/internal/services/command_service.go`)
```go
type CommandService interface {
    SimpleExecute(ctx context.Context, workDir, command string, args ...string) error
    StreamExecute(ctx context.Context, workDir, command string, args ...string) (<-chan string, error)
}
```

**Git Service** (`agents/internal/services/git_service.go`)
```go
type GitService interface {
    CommitAndPush(ctx context.Context, projectGuid, message string) error
    Clone(ctx context.Context, repoURL, targetPath string) error
    Pull(ctx context.Context, projectPath string) error
}
```

---

## ğŸš€ å¼€å‘è§„èŒƒ

### 1. Go ä»£ç è§„èŒƒ

- **åŒ…å¯¼å…¥é¡ºåº**: æ ‡å‡†åº“ â†’ ç¬¬ä¸‰æ–¹åº“ â†’ é¡¹ç›®å†…éƒ¨åŒ…
- **é”™è¯¯å¤„ç†**: ä½¿ç”¨ `fmt.Errorf` åŒ…è£…é”™è¯¯ï¼Œæä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯
- **æ—¥å¿—è®°å½•**: ä½¿ç”¨ `shared-models/logger` ç»Ÿä¸€æ—¥å¿—æ¥å£
- **å‘½åè§„èŒƒ**: 
  - åŒ…å: å°å†™ï¼Œå•æ•°å½¢å¼
  - æ¥å£: æè¿°æ€§åè¯ + åç¼€ `er` (å¦‚ `ProjectService`)
  - ç»“æ„ä½“: PascalCase
  - å‡½æ•°: PascalCase (å…¬å¼€) / camelCase (ç§æœ‰)

**ç¤ºä¾‹**:
```go
package services

import (
    "context"
    "fmt"
    
    "autocodeweb-backend/internal/models"
    "shared-models/common"
    "shared-models/logger"
)

type projectService struct {
    repo repositories.ProjectRepository
}

func (s *projectService) Create(ctx context.Context, req *models.CreateProjectRequest) (*models.Project, error) {
    if err := validateRequest(req); err != nil {
        return nil, fmt.Errorf("validate request: %w", err)
    }
    
    project, err := s.repo.Create(ctx, req)
    if err != nil {
        logger.Error("åˆ›å»ºé¡¹ç›®å¤±è´¥", 
            logger.String("name", req.Name),
            logger.String("error", err.Error()),
        )
        return nil, fmt.Errorf("create project: %w", err)
    }
    
    return project, nil
}
```

### 2. TypeScript/Vue ä»£ç è§„èŒƒ

- **ç»„ä»¶å‘½å**: PascalCase (å¦‚ `ProjectPanel.vue`)
- **Props å®šä¹‰**: ä½¿ç”¨ `defineProps<T>()` æŒ‡å®šç±»å‹
- **äº‹ä»¶å‘½å**: kebab-case (å¦‚ `@project-created`)
- **æ ·å¼éš”ç¦»**: ä½¿ç”¨ `<style scoped>`
- **çŠ¶æ€ç®¡ç†**: å¤æ‚çŠ¶æ€ä½¿ç”¨ Pinia Store

**ç¤ºä¾‹**:
```typescript
// ProjectPanel.vue
<script setup lang="ts">
import { ref, computed } from 'vue'
import type { Project } from '@/types/project'

interface Props {
  project: Project
  readonly?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  readonly: false
})

const emit = defineEmits<{
  'project-updated': [project: Project]
  'file-selected': [path: string]
}>()

const selectedFile = ref<string>('')

const handleFileClick = (path: string) => {
  selectedFile.value = path
  emit('file-selected', path)
}
</script>

<style scoped lang="scss">
.project-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
  
  &__header {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--border-color);
  }
}
</style>
```

### 3. API æ¥å£è§„èŒƒ

**RESTful è®¾è®¡åŸåˆ™**:
- `GET /api/v1/projects` - è·å–é¡¹ç›®åˆ—è¡¨
- `POST /api/v1/projects` - åˆ›å»ºé¡¹ç›®
- `GET /api/v1/projects/{id}` - è·å–é¡¹ç›®è¯¦æƒ…
- `PUT /api/v1/projects/{id}` - æ›´æ–°é¡¹ç›®
- `DELETE /api/v1/projects/{id}` - åˆ é™¤é¡¹ç›®

**ç»Ÿä¸€å“åº”æ ¼å¼**:
```json
{
  "code": 0,
  "message": "success",
  "data": { /* ... */ },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### 4. æ•°æ®åº“æ“ä½œè§„èŒƒ

- **ä½¿ç”¨ Repository æ¨¡å¼**: æ•°æ®è®¿é—®é€»è¾‘å°è£…åœ¨ Repository å±‚
- **äº‹åŠ¡å¤„ç†**: æ¶‰åŠå¤šè¡¨æ“ä½œä½¿ç”¨äº‹åŠ¡
- **è½¯åˆ é™¤**: é‡è¦æ•°æ®ä½¿ç”¨è½¯åˆ é™¤ (`deleted_at`)
- **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•

---

## ğŸ” å®‰å…¨è€ƒè™‘

### 1. è®¤è¯ä¸æˆæƒ

- **JWT Token**: æ— çŠ¶æ€è®¤è¯ï¼ŒAccess Token + Refresh Token
- **Token åˆ·æ–°**: Access Token è¿‡æœŸè‡ªåŠ¨åˆ·æ–°
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)

### 2. æ•°æ®å®‰å…¨

- **å¯†ç åŠ å¯†**: ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- **SQL æ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨ GORM å‚æ•°åŒ–æŸ¥è¯¢
- **XSS é˜²æŠ¤**: å‰ç«¯è¾“å…¥éªŒè¯å’Œè½¬ä¹‰

### 3. API å®‰å…¨

- **CORS é…ç½®**: é™åˆ¶è·¨åŸŸè¯·æ±‚æ¥æº
- **é™æµä¿æŠ¤**: ä½¿ç”¨ Redis å®ç° API é™æµ
- **æ—¥å¿—å®¡è®¡**: è®°å½•å…³é”®æ“ä½œæ—¥å¿—

---

## ğŸ“ é‡è¦æç¤º

### æ·»åŠ æ–°åŠŸèƒ½æ—¶çš„æ³¨æ„äº‹é¡¹

1. **æ–°å¢ Agent ä»»åŠ¡ç±»å‹**:
   - åœ¨ `shared-models/agent/requests.go` æ·»åŠ è¯·æ±‚ç»“æ„ä½“ï¼ˆåŒ…å« `CliTool` å­—æ®µï¼‰
   - åœ¨ `shared-models/client/agent_client.go` æ·»åŠ å®¢æˆ·ç«¯æ–¹æ³•
   - åœ¨ `agents/internal/api/handlers` æ·»åŠ å¯¹åº” Handlerï¼ˆéœ€æ ¹æ® CLI ç±»å‹é€‚é… Promptï¼‰
   - åœ¨ `backend/internal/services/project_stage_service.go` æ·»åŠ é˜¶æ®µæ‰§è¡Œé€»è¾‘ï¼ˆä¼ é€’ CLI ç±»å‹ï¼‰

2. **æ–°å¢å¼€å‘é˜¶æ®µ**:
   - åœ¨ `shared-models/common/constants.go` æ·»åŠ é˜¶æ®µå¸¸é‡
   - æ›´æ–° `GetDevStageDescription()` å’Œ `GetDevStageProgress()` å‡½æ•°
   - åœ¨ `project_stage_service.go` çš„ stages æ•°ç»„ä¸­æ·»åŠ é˜¶æ®µ

3. **ä¿®æ”¹æ•°æ®æ¨¡å‹**:
   - æ›´æ–° `backend/internal/models` ä¸­çš„æ¨¡å‹å®šä¹‰
   - æ›´æ–°æ•°æ®åº“è¿ç§»è„šæœ¬
   - æ›´æ–° `frontend/src/types` ä¸­çš„ TypeScript ç±»å‹å®šä¹‰

4. **æ–°å¢ WebSocket æ¶ˆæ¯ç±»å‹**:
   - åœ¨ `shared-models/common/constants.go` æ·»åŠ æ¶ˆæ¯ç±»å‹å¸¸é‡
   - åœ¨ `backend/internal/models/websocket.go` æ·»åŠ æ¶ˆæ¯ç»“æ„ä½“
   - åœ¨å‰ç«¯ `websocket.ts` ä¸­å¤„ç†æ–°æ¶ˆæ¯ç±»å‹

5. **æ–°å¢æˆ–ä¿®æ”¹ CLI å·¥å…·æ”¯æŒ**:
   - åœ¨ `shared-models/common/constants.go` æ·»åŠ  CLI å·¥å…·å¸¸é‡
   - åœ¨ `agents/internal/services/agent_task_service.go` æ·»åŠ å‘½ä»¤æ„å»ºé€»è¾‘
   - åœ¨æ‰€æœ‰ Agent Handlers ä¸­æ·»åŠ  Prompt é€‚é…é€»è¾‘
   - æ›´æ–° `agents/internal/services/project_service.go` çš„æ£€æµ‹æ–¹æ³•
   - æ›´æ–°å¥åº·æ£€æŸ¥æ¥å£ä»¥æ”¯æŒæ–° CLI çš„ç‰ˆæœ¬æ£€æµ‹

---

## ğŸ› ï¸ CLI å·¥å…·æ”¯æŒ

### æ”¯æŒçš„ CLI ç±»å‹

ç³»ç»Ÿæ”¯æŒä¸‰ç§ AI CLI å·¥å…·ï¼Œç”¨äºæ‰§è¡Œ Agent ä»»åŠ¡ï¼š

| CLI å·¥å…· | å‘½ä»¤åç§° | ç‰¹ç‚¹ | Prompt æ ¼å¼ |
|---------|---------|------|------------|
| **Claude Code** | `claude` | ç¨³å®šï¼Œæ”¯æŒ JSON è¾“å‡ºï¼Œå¯æ¢å¤ä¼šè¯ | `@bmad/xxx.mdc` |
| **Qwen Code** | `qwen` | å›½å†…å¯ç”¨ï¼Œçº¯æ–‡æœ¬è¾“å‡º | `@bmad/xxx.mdc` |
| **Gemini** | `gemini` | Google ç™»å½•ï¼Œéœ€ç‰¹æ®Š Prompt | `@.bmad-core/agents/xxx.md` |

### CLI ç±»å‹æ£€æµ‹æœºåˆ¶

**ä½ç½®**: `agents/internal/services/project_service.go`

```go
func (s *projectService) DetectCliTool(projectGuid string) string {
    projectPath := s.getProjectPath(projectGuid)
    
    // æ ¹æ®ç›®å½•æ£€æµ‹ CLI ç±»å‹
    if utils.FileExists(filepath.Join(projectPath, ".claude")) {
        return common.CliToolClaudeCode
    }
    if utils.FileExists(filepath.Join(projectPath, ".qwen")) {
        return common.CliToolQwenCode
    }
    if utils.FileExists(filepath.Join(projectPath, ".gemini")) {
        return common.CliToolGemini
    }
    
    return common.CliToolClaudeCode // é»˜è®¤
}
```

### CLI ç±»å‹å¤„ç†ä¼˜å…ˆçº§

1. **ä¼˜å…ˆä½¿ç”¨è¯·æ±‚å‚æ•°**: å¦‚æœ `req.BmadCliType` æˆ– `req.CliTool` ä¸ä¸ºç©ºï¼Œä½¿ç”¨è¯¥å€¼
2. **æ£€æµ‹æœ¬åœ°ç›®å½•**: å¦‚æœè¯·æ±‚å‚æ•°ä¸ºç©ºï¼Œæ ¹æ®é¡¹ç›®ç›®å½•åˆ¤æ–­ï¼ˆ`.claude`, `.qwen`, `.gemini`ï¼‰
3. **éªŒè¯å¹¶å®‰è£…**: å¦‚æœ CLI å¯¹åº”ç›®å½•ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨æ‰§è¡Œ `npx bmad-method install -f -i <cli-type> -d .`
4. **é»˜è®¤å€¼**: éƒ½ä¸æ»¡è¶³æ—¶ä½¿ç”¨ `claude-code`

### å‘½ä»¤æ‰§è¡Œé€‚é…

**ä½ç½®**: `agents/internal/services/agent_task_service.go`

```go
// æ ¹æ® CLI ç±»å‹æ„å»ºå‘½ä»¤
switch cliTool {
case common.CliToolClaudeCode:
    cliCommand = "claude"
    useJsonOutput = true
    args = []string{"--dangerously-skip-permissions", "--output-format", "json", "-p", prompt}
    
case common.CliToolQwenCode:
    cliCommand = "qwen"
    useJsonOutput = false  // çº¯æ–‡æœ¬è¾“å‡º
    args = []string{"-y", "-p", prompt}
    
case common.CliToolGemini:
    cliCommand = "gemini"
    useJsonOutput = false  // çº¯æ–‡æœ¬è¾“å‡º
    args = []string{"-y", "-p", prompt}
}

result = h.commandService.SimpleExecute(ctx, projectGUID, cliCommand, args...)

// æ ¹æ®è¾“å‡ºæ ¼å¼å¤„ç†ç»“æœ
if useJsonOutput {
    // Claude: è§£æ JSON æ ¼å¼è¾“å‡º
    json.Unmarshal([]byte(result.Output), &claudeResponse)
} else {
    // Qwen/Gemini: ç›´æ¥ä½¿ç”¨æ–‡æœ¬è¾“å‡º
    claudeResponse.Result = result.Output
}
```

### Prompt é€‚é…ç­–ç•¥

**ä½ç½®**: `agents/internal/api/handlers/*_handler.go`

æ¯ä¸ª Handler æ ¹æ® CLI ç±»å‹é€‰æ‹©ä¸åŒçš„ Prompt æ ¼å¼ï¼š

```go
// ç¤ºä¾‹ï¼šPM Handler
func (s *PmHandler) GetPRD(c *gin.Context) {
    var req agent.GetPRDReq
    c.ShouldBindJSON(&req)
    
    // æ ¹æ® CLI ç±»å‹é€‰æ‹© Prompt
    var agentPrompt string
    if req.CliTool == common.CliToolGemini {
        agentPrompt = "@.bmad-core/agents/pm.md"  // Gemini ç‰¹æ®Šæ ¼å¼
    } else {
        agentPrompt = "@bmad/pm.mdc"              // Claude/Qwen é€šç”¨æ ¼å¼
    }
    
    message := agentPrompt + " æˆ‘å¸Œæœ›ä½ æ ¹æ® @docs/analyse ç›®å½•..."
    // ...
}
```

**Agent Prompt æ˜ å°„è¡¨**:

| Agent | Claude/Qwen | Gemini |
|-------|------------|--------|
| Analyst | `@bmad/analyst.mdc` | `@.bmad-core/agents/analyst.md` |
| PM | `@bmad/pm.mdc` | `@.bmad-core/agents/pm.md` |
| UX Expert | `@bmad/ux-expert.mdc` | `@.bmad-core/agents/ux-expert.md` |
| Architect | `@bmad/architect.mdc` | `@.bmad-core/agents/architect.md` |
| PO | `@bmad/po.mdc` | `@.bmad-core/agents/po.md` |
| Dev | `@bmad/dev.mdc` | `@.bmad-core/agents/dev.md` |

### CLI ç±»å‹ä¼ é€’æµç¨‹

```
Frontend (UserSettings)
  â†“ é€‰æ‹© CLI ç±»å‹
Project.CliTool (å­˜å‚¨åœ¨æ•°æ®åº“)
  â†“ 
Backend (project_stage_service.go)
  â†“ getCliTool(project)
  â†“ ä¼˜å…ˆçº§: project.CliTool â†’ user.DefaultCliTool â†’ default
Agent Request (å„ç§ *Req ç»“æ„ä½“)
  â†“ CliTool å­—æ®µ
Agents Service (handlers)
  â†“ é€‰æ‹© Prompt æ ¼å¼
AgentTaskService
  â†“ æ„å»ºæ‰§è¡Œå‘½ä»¤
CommandService
  â†“ æ‰§è¡Œå¯¹åº” CLI
```

### å¥åº·æ£€æŸ¥

**Agents å¥åº·æ£€æŸ¥** (`agents/internal/api/handlers/health.go`):

```go
type AgentHealthResp struct {
    Status      string            `json:"status"`
    Version     string            `json:"version"`
    Environment map[string]string `json:"environment"`
}

// æ£€æŸ¥ Node.jsã€npx å’Œä¸‰ç§ CLI çš„ç‰ˆæœ¬
result.Environment["node"] = getVersion("node", "--version")
result.Environment["npx"] = getVersion("npx", "--version")
result.Environment["claude-code"] = getVersion("claude", "--version")
result.Environment["qwen-code"] = getVersion("qwen", "--version")
result.Environment["gemini"] = getVersion("gemini", "--version")
```

**Backend å¥åº·æ£€æŸ¥** (`backend/internal/api/handlers/health.go`):

```go
type BackendHealthResp struct {
    Status       string                  `json:"status"`
    Version      string                  `json:"version"`
    AgentService *agent.AgentHealthResp  `json:"agent_service"`
}

// è°ƒç”¨ Agent æœåŠ¡å¥åº·æ£€æŸ¥
agentClient := client.NewAgentClient(agentsURL, 5*time.Second)
if agentHealth, err := agentClient.HealthCheck(ctx); err == nil {
    resp.AgentService = agentHealth
} else {
    resp.AgentService = &agent.AgentHealthResp{Status: "unavailable"}
}
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **æ•´ä½“æ¶æ„**: `docs/architect/Overall_Architecture.md`
- **åç«¯æ¶æ„**: `docs/architect/Backend_Architecture.md`
- **å‰ç«¯æ¶æ„**: `docs/architect/Frontend_Architecture.md`
- **API è®¾è®¡**: `docs/architect/API_Design.md`
- **æ•°æ®æ¨¡å‹**: `docs/architect/Data_Model_Design.md`
- **Agents æ¶æ„**: `agents/design/ARCHITECTURE.md`
- **Shared-Models**: `shared-models/README.md`

---

## ğŸ¯ å¿«é€Ÿå¼€å‘æ£€æŸ¥æ¸…å•

### ä¿®æ”¹ç°æœ‰åŠŸèƒ½
- [ ] ç¡®è®¤ä¿®æ”¹çš„æ–‡ä»¶ä½ç½®å’Œä¾èµ–å…³ç³»
- [ ] æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–° shared-models
- [ ] æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°å‰åç«¯ç±»å‹å®šä¹‰
- [ ] æ£€æŸ¥æ˜¯å¦éœ€è¦æ•°æ®åº“è¿ç§»
- [ ] æ›´æ–°ç›¸å…³æµ‹è¯•ç”¨ä¾‹
- [ ] æ£€æŸ¥æ—¥å¿—è¾“å‡º

### æ·»åŠ æ–°åŠŸèƒ½
- [ ] è®¾è®¡åŠŸèƒ½æµç¨‹å’Œæ•°æ®æµ
- [ ] ç¡®å®šæ¶‰åŠçš„æœåŠ¡å’Œç»„ä»¶
- [ ] æ·»åŠ å¿…è¦çš„å¸¸é‡å’Œç±»å‹å®šä¹‰
- [ ] å®ç°åç«¯æœåŠ¡å’Œ API
- [ ] å®ç°å‰ç«¯ç»„ä»¶å’ŒçŠ¶æ€ç®¡ç†
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- [ ] æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§
- [ ] æ›´æ–°æ–‡æ¡£

### è°ƒè¯•é—®é¢˜
- [ ] æ£€æŸ¥æ—¥å¿—è¾“å‡º (backend/logs/app.log, agents/logs/app-maker-agents.log)
- [ ] æ£€æŸ¥ WebSocket è¿æ¥çŠ¶æ€
- [ ] æ£€æŸ¥æ•°æ®åº“è®°å½•
- [ ] æ£€æŸ¥ Agent ä»»åŠ¡çŠ¶æ€
- [ ] æ£€æŸ¥ Git ä»“åº“æäº¤è®°å½•

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1
**æœ€åæ›´æ–°**: 2024-10-14
**ç»´æŠ¤è€…**: AIæ¢è¶£æ˜Ÿèˆ¹é•¿

**æ›´æ–°æ—¥å¿—**:
- v1.1 (2024-10-14): æ–°å¢ CLI å·¥å…·æ”¯æŒç« èŠ‚ï¼ŒåŒ…å« Claude Codeã€Qwen Codeã€Gemini ä¸‰ç§ CLI çš„é€‚é…æœºåˆ¶
- v1.0 (2024-01-15): åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«æ•´ä½“æ¶æ„å’Œæ ¸å¿ƒåŠŸèƒ½è¯´æ˜

> ğŸ’¡ æç¤ºï¼šæœ¬æ–‡æ¡£æ—¨åœ¨å¸®åŠ© AI åŠ©æ‰‹å¿«é€Ÿç†è§£é¡¹ç›®æ¶æ„ï¼Œç¡®ä¿åœ¨æ–°ä¼šè¯ä¸­ä¿æŒä¸€è‡´çš„å¼€å‘æ–¹å¼ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¯·ç»“åˆå…·ä½“ä»£ç å’Œéœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚

